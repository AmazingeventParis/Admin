<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Candy Puzzle - Administration</title>
    <link rel="stylesheet" href="style.css">
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
</head>
<body>
    <div class="container">
        <!-- Header -->
        <header class="header">
            <h1>Candy Puzzle - Admin</h1>
            <p class="subtitle">Panneau d'administration</p>
        </header>

        <!-- Stats Dashboard -->
        <section class="dashboard">
            <h2>Statistiques</h2>
            <div class="stats-grid">
                <div class="stat-card">
                    <div class="stat-icon">üë•</div>
                    <div class="stat-value" id="totalUsers">-</div>
                    <div class="stat-label">Total Utilisateurs</div>
                </div>
                <div class="stat-card">
                    <div class="stat-icon">‚úÖ</div>
                    <div class="stat-value" id="realUsers">-</div>
                    <div class="stat-label">Vrais joueurs</div>
                </div>
                <div class="stat-card">
                    <div class="stat-icon">ü§ñ</div>
                    <div class="stat-value" id="fakeUsers">-</div>
                    <div class="stat-label">Faux profils</div>
                </div>
                <div class="stat-card">
                    <div class="stat-icon">üéÆ</div>
                    <div class="stat-value" id="totalGames">-</div>
                    <div class="stat-label">Parties jou√©es</div>
                </div>
                <div class="stat-card">
                    <div class="stat-icon">üèÜ</div>
                    <div class="stat-value" id="bestScore">-</div>
                    <div class="stat-label">Meilleur score</div>
                </div>
            </div>
            <button class="btn btn-refresh" onclick="loadStats()">üîÑ Actualiser</button>
        </section>

        <!-- Fake Profile Generator -->
        <section class="generator">
            <h2>G√©n√©rateur de Faux Profils</h2>
            <p class="description">G√©n√®re des profils fictifs avec photos et noms r√©alistes via randomuser.me</p>

            <div class="generator-controls">
                <div class="control-group">
                    <label for="profileCount">Nombre de profils :</label>
                    <input type="number" id="profileCount" value="5" min="1" max="50">
                </div>
                <div class="control-group">
                    <label for="nationality">Nationalit√© :</label>
                    <select id="nationality">
                        <option value="">Al√©atoire</option>
                        <option value="fr" selected>France</option>
                        <option value="us">√âtats-Unis</option>
                        <option value="gb">Royaume-Uni</option>
                        <option value="de">Allemagne</option>
                        <option value="es">Espagne</option>
                        <option value="it">Italie</option>
                        <option value="br">Br√©sil</option>
                    </select>
                </div>
                <div class="control-group">
                    <label for="gender">Genre :</label>
                    <select id="gender">
                        <option value="">Al√©atoire</option>
                        <option value="male">Homme</option>
                        <option value="female">Femme</option>
                    </select>
                </div>
                <div class="control-group">
                    <label for="minScore">Score minimum :</label>
                    <input type="number" id="minScore" value="1000" min="0" max="999999">
                </div>
                <div class="control-group">
                    <label for="maxScore">Score maximum :</label>
                    <input type="number" id="maxScore" value="15000" min="0" max="999999">
                </div>
                <button class="btn btn-generate" onclick="generateProfiles()">‚ú® G√©n√©rer les profils</button>
            </div>

            <!-- Preview -->
            <div class="preview-section" id="previewSection" style="display: none;">
                <h3>Aper√ßu des profils g√©n√©r√©s</h3>
                <div class="profiles-grid" id="profilesPreview"></div>
                <div class="preview-actions">
                    <button class="btn btn-cancel" onclick="cancelProfiles()">‚ùå Annuler</button>
                    <button class="btn btn-confirm" onclick="confirmProfiles()">‚úÖ Ajouter √† la base</button>
                </div>
            </div>

            <!-- Loading -->
            <div class="loading" id="loading" style="display: none;">
                <div class="spinner"></div>
                <p>G√©n√©ration en cours...</p>
            </div>
        </section>

        <!-- Users List -->
        <section class="users-list">
            <h2>Liste des Utilisateurs</h2>
            <div class="filter-controls">
                <div class="control-group">
                    <label for="userFilter">Filtrer par :</label>
                    <select id="userFilter" onchange="loadUsers()">
                        <option value="all">Tous</option>
                        <option value="real">Vrais joueurs</option>
                        <option value="fake">Faux profils (Bots)</option>
                    </select>
                </div>
            </div>
            <div class="table-container">
                <table id="usersTable">
                    <thead>
                        <tr>
                            <th>Photo</th>
                            <th>Nom</th>
                            <th>Type</th>
                            <th>Parties</th>
                            <th>Meilleur Score</th>
                            <th>Actions</th>
                        </tr>
                    </thead>
                    <tbody id="usersTableBody">
                        <!-- Users will be loaded here -->
                    </tbody>
                </table>
            </div>
        </section>

        <!-- Toast Notifications -->
        <div class="toast" id="toast"></div>

        <!-- Modal Jouer en tant que Bot -->
        <div class="modal-overlay" id="playModal" style="display: none;">
            <div class="modal">
                <div class="modal-header">
                    <h3>üéÆ Jouer en tant que <span id="playAsName">Bot</span></h3>
                    <button class="modal-close" onclick="closePlayModal()">&times;</button>
                </div>
                <div class="modal-body">
                    <div id="playModalLoading" class="loading">
                        <div class="spinner"></div>
                        <p>Chargement des duels...</p>
                    </div>
                    <div id="playModalContent" style="display: none;">
                        <h4>üì© Duels en attente</h4>
                        <div id="pendingDuelsList"></div>

                        <h4 style="margin-top: 20px;">‚öîÔ∏è Duels actifs (√† jouer)</h4>
                        <div id="activeDuelsList"></div>

                        <h4 style="margin-top: 20px;">üë• Demandes d'amis</h4>
                        <div id="friendRequestsList"></div>

                        <h4 style="margin-top: 20px;">üì§ D√©fier un joueur</h4>
                        <div class="challenge-section">
                            <select id="challengeTarget">
                                <option value="">S√©lectionner un joueur...</option>
                            </select>
                            <button class="btn btn-generate" onclick="createChallenge()">‚öîÔ∏è D√©fier</button>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Modal Chat Simulator -->
        <div class="modal-overlay" id="chatModal" style="display: none;">
            <div class="modal" style="max-width: 800px;">
                <div class="modal-header">
                    <h3>üí¨ Simulateur de Chat - <span id="chatBotName">Bot</span></h3>
                    <button class="modal-close" onclick="closeChatModal()">&times;</button>
                </div>
                <div class="modal-body">
                    <div id="chatModalLoading" class="loading">
                        <div class="spinner"></div>
                        <p>Chargement des conversations...</p>
                    </div>
                    <div id="chatModalContent" style="display: none;">
                        <!-- Liste des conversations -->
                        <div id="conversationsList">
                            <h4>üì± Conversations</h4>
                            <div id="conversationsContainer"></div>
                        </div>

                        <!-- Zone de chat active -->
                        <div id="activeChatSection" style="display: none; margin-top: 20px;">
                            <div class="chat-header">
                                <img id="chatPartnerPhoto" src="" alt="">
                                <div>
                                    <span id="chatPartnerName">-</span>
                                    <span id="chatPartnerTyping" class="typing-indicator" style="display: none;">√©crit...</span>
                                </div>
                            </div>
                            <div id="chatMessages" class="chat-messages"></div>
                            <div class="chat-input-container">
                                <input type="text" id="chatInput" placeholder="√âcrire un message..." onkeypress="handleChatKeyPress(event)" oninput="handleChatInput()">
                                <button class="btn btn-generate" onclick="sendChatMessage()">üì§ Envoyer</button>
                            </div>
                        </div>

                        <!-- Nouvelle conversation -->
                        <div style="margin-top: 20px;">
                            <h4>‚ûï Nouvelle conversation</h4>
                            <div class="challenge-section">
                                <select id="newChatTarget">
                                    <option value="">S√©lectionner un joueur...</option>
                                </select>
                                <button class="btn btn-generate" onclick="startNewChat()">üí¨ D√©marrer</button>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Modal Simuler Partie -->
        <div class="modal-overlay" id="simulateModal" style="display: none;">
            <div class="modal">
                <div class="modal-header">
                    <h3>üéØ Simuler une partie</h3>
                    <button class="modal-close" onclick="closeSimulateModal()">&times;</button>
                </div>
                <div class="modal-body">
                    <p id="simulateInfo"></p>
                    <div class="control-group" style="margin: 20px 0;">
                        <label for="simulateScore">Score √† soumettre :</label>
                        <input type="number" id="simulateScore" value="5000" min="0" max="999999">
                    </div>
                    <div class="preview-actions">
                        <button class="btn btn-cancel" onclick="closeSimulateModal()">Annuler</button>
                        <button class="btn btn-confirm" onclick="submitSimulatedScore()">‚úÖ Soumettre le score</button>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script src="admin.js"></script>
</body>
</html>
